parameters:
  appId: ''
  appSecret: ''
  botName: ''
  botGroup: ''
  botPricingTier: ""
  resourceSuffix: ""
  appServicePlan: ""
  appServicePlanRG: ""
  appInsight: ""
  templateFile: ""

steps:
  - task: AzureCLI@2
    displayName: 'Create resources'
    inputs:
      azureSubscription: $(AzureSubscription)
      scriptType: pscore
      scriptLocation: inlineScript
      inlineScript: |
        Set-PSDebug -Trace 1;

        $botPricingTier = if("${{ parameters.botPricingTier }}") { "botSku="${{ parameters.botPricingTier }}" };
        $appInsights = if("${{ parameters.appInsight }}") { "appInsightsName"="${{ parameters.appInsight }} }

        az deployment group create --resource-group "${{ parameters.botGroup }}" --name "${{ parameters.botName }}${{ parameters.resourceSuffix }}-$(Build.BuildId)" --template-file ${{ parameters.templateFile }} --parameters $botPricingTier botLocation="westus" appId="${{ parameters.appId }}" appSecret="${{ parameters.appSecret }}" botName="${{ parameters.botName }}${{ parameters.resourceSuffix }}-$(Build.BuildId)" appServicePlanName="${{ parameters.appServicePlan }}" appServicePlanResourceGroup="${{ parameters.appServicePlanRG }}" $appInsights";

        Set-PSDebug -Trace 0;
